# 07 - æ•°æ®ç»Ÿè®¡

> **éš¾åº¦**: â­â­â­ | **é¢„è®¡æ—¶é—´**: 6-8 å°æ—¶

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

Admin ç«¯æ•°æ®ä»ªè¡¨ç›˜ï¼Œå±•ç¤ºå›¾ä¹¦é¦†è¿è¥æ•°æ®å’Œè¶‹åŠ¿å›¾è¡¨ã€‚

---

## âœ… ä»»åŠ¡æ¸…å•

### 1. ç»Ÿè®¡ API

| æ–¹æ³• | è·¯å¾„                            | æƒé™  | è¯´æ˜     |
| ---- | ------------------------------- | ----- | -------- |
| GET  | `/api/statistics/overview`      | ADMIN | æ€»è§ˆæ•°æ® |
| GET  | `/api/statistics/loans/trend`   | ADMIN | å€Ÿé˜…è¶‹åŠ¿ |
| GET  | `/api/statistics/books/popular` | ADMIN | çƒ­é—¨ä¹¦ç± |
| GET  | `/api/statistics/users/active`  | ADMIN | æ´»è·ƒç”¨æˆ· |
| GET  | `/api/statistics/categories`    | ADMIN | åˆ†ç±»ç»Ÿè®¡ |

---

### 2. ç»Ÿè®¡æ•°æ®

```typescript
// statisticsService.ts

// æ€»è§ˆæ•°æ®
async function getOverview() {
  return {
    totalBooks: await prisma.book.count(),
    totalUsers: await prisma.user.count(),
    totalLoans: await prisma.loan.count(),
    activeLoans: await prisma.loan.count({ where: { status: "APPROVED" } }),
    pendingLoans: await prisma.loan.count({ where: { status: "PENDING" } }),
    overdueLoans: await prisma.loan.count({ where: { status: "OVERDUE" } }),
    monthlyLoans: await prisma.loan.count({
      where: {
        createdAt: {
          gte: startOfMonth(new Date()),
        },
      },
    }),
  };
}

// å€Ÿé˜…è¶‹åŠ¿ï¼ˆè¿‘30å¤©æ¯æ—¥å€Ÿé˜…æ•°ï¼‰
async function getLoanTrend() {
  // GROUP BY date
}

// çƒ­é—¨ä¹¦ç± TOP 10
async function getPopularBooks() {
  // GROUP BY bookId, COUNT, ORDER BY count DESC
}

// åˆ†ç±»ç»Ÿè®¡ï¼ˆé¥¼å›¾æ•°æ®ï¼‰
async function getCategoryStats() {
  // GROUP BY category
}
```

---

### 3. å‰ç«¯é¡µé¢

#### Admin ä»ªè¡¨ç›˜

- [ ] æ•°æ®å¡ç‰‡ï¼ˆæ€»ä¹¦ç±æ•°ã€ç”¨æˆ·æ•°ã€æœ¬æœˆå€Ÿé˜…ç­‰ï¼‰
- [ ] å€Ÿé˜…è¶‹åŠ¿æŠ˜çº¿å›¾
- [ ] çƒ­é—¨ä¹¦ç± TOP 10 åˆ—è¡¨
- [ ] åˆ†ç±»å æ¯”é¥¼å›¾
- [ ] æ—¥æœŸèŒƒå›´ç­›é€‰å™¨

#### æ¨èå›¾è¡¨åº“

- `recharts` - React å›¾è¡¨åº“
- `chart.js` + `react-chartjs-2`

---

### 4. UI å‚è€ƒ

```
+----------------------------------------------------------+
| Dashboard                                                 |
+----------------------------------------------------------+
| [æ€»ä¹¦ç±: 1,234] [ç”¨æˆ·æ•°: 567] [æœ¬æœˆå€Ÿé˜…: 89] [å¾…å®¡æ ¸: 12] |
+----------------------------------------------------------+
| å€Ÿé˜…è¶‹åŠ¿ (è¿‘30å¤©)              | çƒ­é—¨ä¹¦ç± TOP 10          |
| [æŠ˜çº¿å›¾]                       | 1. JavaScriptå…¥é—¨ (45æ¬¡) |
|                                | 2. Reactå®æˆ˜ (38æ¬¡)      |
|                                | ...                       |
+----------------------------------------------------------+
| åˆ†ç±»ç»Ÿè®¡                       | é€¾æœŸç‡ç»Ÿè®¡                |
| [é¥¼å›¾]                         | [è¿›åº¦æ¡æˆ–æ•°å­—]            |
+----------------------------------------------------------+
```

---

## âœ… å®Œæˆæ ‡å¿—

- [ ] ä»ªè¡¨ç›˜å±•ç¤ºå…³é”®æŒ‡æ ‡
- [ ] å€Ÿé˜…è¶‹åŠ¿å›¾å¯è§†åŒ–
- [ ] çƒ­é—¨ä¹¦ç±æ’è¡Œæ¦œ
- [ ] åˆ†ç±»ç»Ÿè®¡é¥¼å›¾
