# 01-2 åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·

> **éš¾åº¦**: â­ | **é¢„è®¡æ—¶é—´**: 15 åˆ†é’Ÿ

## ğŸ“‹ ä»»åŠ¡ç›®æ ‡

åœ¨æ•°æ®åº“ä¸­åˆ›å»ºä¸€ä¸ªç®¡ç†å‘˜è´¦æˆ·ç”¨äºæµ‹è¯•ã€‚

---

## âœ… æ–¹å¼ä¸€: ä½¿ç”¨ Prisma Studioï¼ˆæ¨èï¼‰

æœ€ç®€å•çš„æ–¹å¼ï¼Œç›´æ¥åœ¨ UI ä¸­ä¿®æ”¹ï¼š

### æ­¥éª¤

1. [ ] ç¡®ä¿ Prisma Studio æ­£åœ¨è¿è¡Œ: `npx prisma studio`
2. [ ] æ‰“å¼€æµè§ˆå™¨è®¿é—® `http://localhost:5555`
3. [ ] ç‚¹å‡»å·¦ä¾§çš„ `User` è¡¨
4. [ ] æ‰¾åˆ°è¦å‡çº§çš„ç”¨æˆ·ï¼Œæˆ–è€…æ–°å»ºä¸€ä¸ªç”¨æˆ·
5. [ ] å°† `role` å­—æ®µä» `USER` æ”¹ä¸º `ADMIN`
6. [ ] ç‚¹å‡» `Save 1 change` æŒ‰é’®

---

## âœ… æ–¹å¼äºŒ: åˆ›å»º Seed è„šæœ¬

å¦‚æœéœ€è¦åœ¨å¤šä¸ªç¯å¢ƒä¸­ä½¿ç”¨ï¼Œå¯ä»¥åˆ›å»º seed è„šæœ¬ï¼š

### æ­¥éª¤ 1: åˆ›å»º seed æ–‡ä»¶

**æ–‡ä»¶**: `backend/prisma/seed.ts`

```typescript
import { PrismaClient, Role } from "@prisma/client";
import bcrypt from "bcryptjs";

const prisma = new PrismaClient();

async function main() {
  // åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·
  const hashedPassword = await bcrypt.hash("admin123", 10);

  const admin = await prisma.user.upsert({
    where: { email: "admin@library.com" },
    update: {
      role: Role.ADMIN,
    },
    create: {
      email: "admin@library.com",
      password: hashedPassword,
      name: "ç³»ç»Ÿç®¡ç†å‘˜",
      role: Role.ADMIN,
    },
  });

  console.log("âœ… ç®¡ç†å‘˜è´¦æˆ·å·²åˆ›å»º/æ›´æ–°:", admin.email);

  // åˆ›å»ºæ™®é€šç”¨æˆ·ï¼ˆç”¨äºæµ‹è¯•å¯¹æ¯”ï¼‰
  const userPassword = await bcrypt.hash("user123", 10);

  const user = await prisma.user.upsert({
    where: { email: "user@library.com" },
    update: {},
    create: {
      email: "user@library.com",
      password: userPassword,
      name: "æµ‹è¯•ç”¨æˆ·",
      role: Role.USER,
    },
  });

  console.log("âœ… æµ‹è¯•ç”¨æˆ·å·²åˆ›å»º:", user.email);
}

main()
  .catch((e) => {
    console.error("âŒ Seed å¤±è´¥:", e);
    process.exit(1);
  })
  .finally(async () => {
    await prisma.$disconnect();
  });
```

- [ ] å®Œæˆ

---

### æ­¥éª¤ 2: é…ç½® package.json

**æ–‡ä»¶**: `backend/package.json`

åœ¨ `prisma` é…ç½®ä¸­æ·»åŠ  seed å‘½ä»¤ï¼š

```json
{
  "prisma": {
    "seed": "ts-node prisma/seed.ts"
  }
}
```

- [ ] å®Œæˆ

---

### æ­¥éª¤ 3: è¿è¡Œ seed

```bash
cd backend
npx prisma db seed
```

- [ ] å®Œæˆ

---

## ğŸ“ æµ‹è¯•è´¦æˆ·ä¿¡æ¯

| è§’è‰²     | é‚®ç®±              | å¯†ç      |
| -------- | ----------------- | -------- |
| ç®¡ç†å‘˜   | admin@library.com | admin123 |
| æ™®é€šç”¨æˆ· | user@library.com  | user123  |

---

## ğŸ§ª éªŒè¯æ–¹å¼

### ç™»å½•æµ‹è¯•

```bash
# ç®¡ç†å‘˜ç™»å½•
curl -X POST http://localhost:8000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"admin@library.com","password":"admin123"}'

# æ£€æŸ¥è¿”å›çš„ user.role æ˜¯å¦ä¸º "ADMIN"
```

---

## âœ… å®Œæˆæ ‡å¿—

- [ ] æ•°æ®åº“ä¸­å­˜åœ¨ä¸€ä¸ª role ä¸º ADMIN çš„ç”¨æˆ·
- [ ] å¯ä»¥ä½¿ç”¨è¯¥è´¦æˆ·ç™»å½•
- [ ] ç™»å½•è¿”å›çš„ user å¯¹è±¡åŒ…å« role: "ADMIN"
