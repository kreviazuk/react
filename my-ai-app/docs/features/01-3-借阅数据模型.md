# 01-3 å€Ÿé˜…æ•°æ®æ¨¡å‹

> **éš¾åº¦**: â­ | **é¢„è®¡æ—¶é—´**: 15 åˆ†é’Ÿ

## ğŸ“‹ ä»»åŠ¡ç›®æ ‡

æ›´æ–° Prisma schema ä¸­çš„ Loan æ¨¡å‹ï¼Œæ”¯æŒå€Ÿé˜…å®¡æ ¸æµç¨‹ã€‚

---

## âœ… å®ç°æ­¥éª¤

### æ­¥éª¤ 1: æ·»åŠ  LoanStatus æšä¸¾

**æ–‡ä»¶**: `backend/prisma/schema.prisma`

åœ¨æ–‡ä»¶ä¸­æ·»åŠ æ–°çš„æšä¸¾ï¼ˆæ”¾åœ¨å…¶ä»–æšä¸¾é™„è¿‘ï¼‰ï¼š

```prisma
// å€Ÿé˜…çŠ¶æ€æšä¸¾
enum LoanStatus {
  PENDING   // å¾…å®¡æ ¸
  APPROVED  // å·²æ‰¹å‡†ï¼ˆå€Ÿé˜…ä¸­ï¼‰
  REJECTED  // å·²æ‹’ç»
  RETURNED  // å·²å½’è¿˜
  OVERDUE   // é€¾æœŸ
}
```

- [ ] å®Œæˆ

---

### æ­¥éª¤ 2: æ›´æ–° Loan æ¨¡å‹

**æ–‡ä»¶**: `backend/prisma/schema.prisma`

æ›¿æ¢ç°æœ‰çš„ Loan æ¨¡å‹ï¼š

```prisma
// å€Ÿé˜…è®°å½•
model Loan {
  id           Int        @id @default(autoincrement())
  userId       Int
  copyId       Int

  borrowDate   DateTime   @default(now())  // ç”³è¯·æ—¶é—´
  dueDate      DateTime?  // åº”è¿˜æ—¶é—´ï¼ˆæ‰¹å‡†åè®¾ç½®ï¼‰
  returnDate   DateTime?  // å®é™…å½’è¿˜æ—¶é—´

  status       LoanStatus @default(PENDING)
  rejectReason String?    // æ‹’ç»ç†ç”±

  user         User       @relation(fields: [userId], references: [id])
  copy         BookCopy   @relation(fields: [copyId], references: [id])

  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
}
```

**å˜æ›´è¯´æ˜**:

- `status`: String â†’ LoanStatus æšä¸¾
- `dueDate`: æ”¹ä¸ºå¯é€‰ï¼Œæ‰¹å‡†åæ‰è®¾ç½®
- æ–°å¢ `rejectReason`: æ‹’ç»æ—¶å¡«å†™ç†ç”±
- æ–°å¢ `updatedAt`: è‡ªåŠ¨æ›´æ–°æ—¶é—´æˆ³

- [ ] å®Œæˆ

---

### æ­¥éª¤ 3: è¿è¡Œæ•°æ®åº“è¿ç§»

```bash
cd backend
npx prisma migrate dev --name update_loan_status
```

å¦‚æœæç¤ºæ•°æ®å†²çªï¼š

- å¼€å‘ç¯å¢ƒå¯ä»¥é€‰æ‹© `reset` é‡ç½®æ•°æ®åº“
- æˆ–è€…å…ˆæ‰‹åŠ¨å¤„ç†ç°æœ‰æ•°æ®

- [ ] å®Œæˆ

---

### æ­¥éª¤ 4: é‡æ–°ç”Ÿæˆ Prisma Client

```bash
npx prisma generate
```

- [ ] å®Œæˆ

---

## ğŸ“Š çŠ¶æ€æµè½¬å›¾

```
ç”¨æˆ·ç”³è¯·å€Ÿé˜…
     â”‚
     â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ PENDING â”‚ å¾…å®¡æ ¸
  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
       â”‚
  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
  â”‚         â”‚
  â–¼         â–¼
æ‰¹å‡†      æ‹’ç»
  â”‚         â”‚
  â–¼         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ APPROVED â”‚  â”‚ REJECTED â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ å½’è¿˜
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RETURNED â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ³¨: OVERDUE çŠ¶æ€é€šè¿‡å®šæ—¶ä»»åŠ¡æˆ–æ‰‹åŠ¨æ£€æŸ¥è®¾ç½®
```

---

## ğŸ§ª éªŒè¯æ–¹å¼

### åœ¨ Prisma Studio ä¸­æ£€æŸ¥

1. æ‰“å¼€ `http://localhost:5555`
2. æŸ¥çœ‹ Loan è¡¨ç»“æ„
3. ç¡®è®¤ status å­—æ®µç±»å‹å·²æ›´æ–°

---

## âœ… å®Œæˆæ ‡å¿—

- [ ] LoanStatus æšä¸¾å·²æ·»åŠ 
- [ ] Loan æ¨¡å‹å·²æ›´æ–°
- [ ] æ•°æ®åº“è¿ç§»æˆåŠŸ
- [ ] Prisma Client å·²é‡æ–°ç”Ÿæˆ
